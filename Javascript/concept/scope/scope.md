# 스코프를 이해하기 전에
- 변수는 어디에 살아있는가?
- 변수는 어디에 저장되는가?
- 변수가 필요할 때 프로그램은 어디에서 찾는가?

## 컴파일러 이론
- 자바스크립트도 컴파일러 언어이다.

## 컴파일 과정

### 토크나이징
- 문자열을 나누어 `Token`이라 불리는 의미있는 조각으로 만드는 과정

```javascript
    var a = 2;
    /*
    = this is a process about the tokenizing
        var,
        a
        =
        2
        ;
    */
```

### 파싱
- 토큰 배열을 프로그램의 문법 구조를 반영하여 중첩 원소를 갖는 트리 형태로 바꾸는 과정을 의미
파싱의 결과로 만들어진 트리를 AST(추상 구문 트리_Abstract_Syntax_Tree)라 부른다.
```
    var a = 2;

    /*
        AST = 깊이를 통해 과정의 단계를 표현함.[ Tree 구조의 의미 ]

        변수 선언 (Variable Declaration)

        |                           |

        확인자 (Identifier_a값을 확인)  대입 수식 (Assignment Expresstion)

                                    |

                                    2 (value)
    */
```

### 코드 생성
- AST를 컴퓨터에서 실행 코드로 바꾸는 과정을 말한다.

### 실행
- 자바스크립트 컴파일레이션은 보통 코드가 실행되기 겨우 수백만 분의 일초 전에 수행한다.
자바스크립트는 코드가 실행되기 이전에 수행되는 시간이 매우 짧아 상대적으로 실행되는 코드를 최적화할 시간이 많지 않다는 것을 의미한다.

### 해석과정
- 앞에 `var a = 2;`라는 문장을 해석한다고 가정하였다.
1. 먼저 컴파일러는 a가 특정한 스코프 컬렉션 안에 있는 지 찾는다. 없으면 a라는 새로운 변수를 스코프 내에 정의한다.
2. 엔진은 a라는 변수가 현재 스코프 컬렉션 내에서 존재하며, 접근할 수 있는지 확인한다. 만약 a라는 변수가 존재하고 접근할 수 있다면, 값을 대입한다.

#### 컴파일링 과정
- `RHS`와 `LHS`가 있다. R,L은 방향을 뜻한다.
1. LHS 참조
    - 변수가 대입 연산자 왼쪽에 있을 때 실행되는 검색이며, 값을 넣어야하기 떄문에 변수 컨테이너 자체를 갖는다.
    - 대입할 대상을 찾다.
    ```javascript
        a = 2;
    ```

2. RHS 참조
    - 특정 변수의 값을 찾을 때 일어나는 검색이다. 아래로 예를 들면 a의 변수를 찾아야 하는 과정이 먼저 일어나며 이 과정을 `RHS`라 할 수 있다.
    - 다시 말해, 대입한 변수의 참조를 찾는 과정을 의미한다.
    ```javascript
        console.log(a);
    ```

3. LHS와 RHS의 차이
- 변수를 찾지 못했을 때의 처리가 다르다. RHS의 상황일 때는 `Reference Error`가 일어나며 LHS는 새로운 변수를 생성하는 과정을 진행하게 된다.
- ReferenceError는 스코프 내에서 대상을 찾지 못했을 때 발생하는 에러이며, TypeError는 스코프에서 참조값을 찾았으나, 그 값을 통해 진행할 수 없는 과정을 진행하려고 할 때
발생하는 에러를 의미한다.

#### RHS, LHS 연습

```javascript
    function foo(a) {
        var b = a; //RHS(a를 찾아야 한다.) => LHS(찾은 a값을 대입하며, a는 매개변수로 받은 값[2]를 a에 대입한다.)
        return a + b; //RHS * 2(a 와 b를 찾아야 함)
    }

    var c = foo(2); //RHS(함수가 실행될 때 대입되는 값을 가져와야 한다.) => LHS(foo(2)의 결과값을 c변수에 넘긴다.)

    // RHS는 총 4번, LHS는 총 3번 발생한다.
```

# 중첩 스코프
- 변수를 찾기 위한 규칙의 집합이며, 스코프도 다른 스코프안에 중첩(nested)될 수 있다.
문장에서 RHS 참조가 일어날 때 엔진은 스코프 영역 안에서 바깥으로 참조 값을 찾기 위해 헤맨다. 결국 최상위 스코프까지 참조 값을 찾게 된다.

